name: Create new release

on:
  workflow_dispatch:
    inputs:
      release_tag:
        description: "Release tag"
        required: true
      release_name:
        description: "Release name"
        required: true
      run-tests:
        description: "Run all tests (true/false)"
        required: true
jobs:
      release:
        name: Release pushed tag
        runs-on: ubuntu-20.04
        steps:
          - name: Create release
            env:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              tag: ${{ github.event.inputs.release_tag }}
              title: ${{ github.event.inputs.release_name }}
            run: |
              gh release create "$tag" \
                  --repo="$GITHUB_REPOSITORY" \
                  --title="$title" \
                  --generate-notes        



      ubuntu:
        name: Release - Ubuntu
        needs: release
        uses: ./.github/workflows/ubuntu.yml
        with:
          run-tests: ${{ fromJSON(inputs.run-tests) }}

      windows:
        name: Release - Windows
        needs: release
        uses: ./.github/workflows/windows-vcpkg.yml
        with:
          run-tests: ${{ fromJSON(inputs.run-tests) }}
